<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link href="{{url_for('static', path = '/styles.css') }}" rel="stylesheet">
</head>
<body>
    <div class = "title__background">
        <h1 class = "title__word">歡迎光臨，這是會員頁</h1>
    </div>
    <div class = "content">
        <h2 class = "content__word">{{login_name}}，歡迎登入系統</h2>
        <a class = "content__word" href = http://127.0.0.1:8000/signout>登出系統</a>
    </div>
    <hr>
    <form action = "http://127.0.0.1:8000/createMessage" method="POST" id = "createMessage">
        <div class = "content">
            <h2 class = "content__word">快來留言吧</h2>
            <div class = "input">
                <label for = "message">內容</label>
                <input placeholder = "請輸入留言" id = "message" name = "message_content">
            </div>
            <button class = "button" type = "button" id = "buttonMessage">送出</button>
        </div>
    </form>
    <hr>
    <div class = "content">
        {% for message in messages %}
        <div class = "content__word">
            <span class = "content__name">{{ message[0] }}：</span>
            <span>{{ message[1] }}</span>
            {% if user_id == message[3] %}
                <button class = "button__delete" type = "button" id = "buttonDelete" data-message-id = "{{message[2]}}">X</button>
                {% endif %}
        </div> 
        {% endfor %}
    </div>
</body>
<script>
    //取得輸入框的值
    let message = document.getElementById("message")

    //點擊登入，送出資料
    buttonMessage.addEventListener("click",function(){
       //按鈕被點擊時，檢查輸入框是否有填寫內容
        if (message.value.length === 0){ 
            alert("請填寫留言內容"); 
        }else{
            //手動提交表單
            document.getElementById("createMessage").submit();
        }
    });

    //點擊X，刪除留言
    //let buttonDelete = document.querySelectorAll(".button__delete")
    buttonDelete.addEventListener("click",function(){
        //按鈕被點擊時，跳出確認是否刪除視窗
        let deleteConfirm = confirm("確定要刪除留言嗎？");
        if (deleteConfirm){
            //let deletebutton = document.querySelectorAll(".button__delete"); //鎖定按鈕資料
            let messageID = buttonDelete.getAttribute("data-message-id"); //鎖定按鈕裡面的屬性的資料
            alert("我點確定 messageID");
            console.log(messageID);
        }
    });


let deleteButtons = document.querySelectorAll(".button__delete");

for (let i = 0; i < deleteButtons.length; i++) {
    deleteButtons[i].addEventListener("click", function() {
        let deleteConfirm = confirm("確定要刪除留言嗎？");
        if (deleteConfirm) {
            let messageID = deleteButtons[i].getAttribute("data-message-id");
            alert("我點確定 messageID");
            console.log(messageID);
        }
    });
}

/*
var deleteButtons = document.querySelectorAll(".button__delete");

    deleteButtons.forEach(function(button) {
        button.addEventListener("click", function() {
            var messageId = button.getAttribute("data-message-id");
            if (confirm("Are you sure you want to delete this message?")) {
                // 執行刪除操作，可以使用fetch或其他方式向後端發送刪除請求，並將messageId作為參數傳遞
                fetch("/delete_message", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ message_id: messageId })
                }).then(function(response) {
                    // 刪除成功後的處理
                    // 例如重新加載留言列表
                }).catch(function(error) {
                    console.error("Error deleting message:", error);
                });
            }
        });
    });
*/

/* 第一題不用fetch作法，保留寫法

    //點擊登入，送出資料
buttonConsentCheck.addEventListener("click",function(){
    //按鈕被點擊時，跑函式檢查checkbox是否有被勾選
    if (consentBox.checked){
        //找出帳號和密碼填寫的值
        let username = document.getElementById("account").value;
        let password = document.getElementById("password").value;

        //創建FormDate
        let formData = new FormData();
        formData.append("username",username);
        formData.append("password",password);

        // 發送Post給伺服器驗證帳密
        fetch("http://127.0.0.1:8000/signin",{
            method:"POST",
            body:formData
            })
            .then(function(response){
            if(response.redirected){
            window.location.href = response.url;
            }
        })
    }else{
        alert("請先勾選同意條款");
    }
});
*/


</script>
</html>